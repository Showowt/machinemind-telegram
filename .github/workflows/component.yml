name: Component Generator

on:
  workflow_dispatch:
    inputs:
      component_name:
        description: 'Component name'
        required: true
        type: string
      project:
        description: 'Project name'
        required: true
        type: string
      chat_id:
        description: 'Telegram chat ID'
        required: true
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Start
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ inputs.chat_id }}",
              "text": "ğŸ§© <b>Component Generator</b>\n\nğŸ“¦ Creating: <code>${{ inputs.component_name }}</code>\nğŸ“ Project: <code>${{ inputs.project }}</code>",
              "parse_mode": "HTML"
            }'

      - uses: actions/checkout@v4
        with:
          repository: Showowt/${{ inputs.project }}
          token: ${{ secrets.GH_PAT }}

      - name: Generate Component Files
        run: |
          NAME="${{ inputs.component_name }}"
          DIR="components"
          mkdir -p $DIR

          # Main component
          cat > "$DIR/${NAME}.tsx" << 'EOF'
"use client";

import { useState } from "react";

interface ${NAME}Props {
  className?: string;
  children?: React.ReactNode;
}

export function ${NAME}({ className, children }: ${NAME}Props) {
  const [isLoading, setIsLoading] = useState(false);

  if (isLoading) {
    return <div className={className}>Loading...</div>;
  }

  return (
    <div className={className}>
      {children}
    </div>
  );
}
EOF

          # Replace placeholder
          sed -i "s/\${NAME}/$NAME/g" "$DIR/${NAME}.tsx"

      - name: Commit & Push
        run: |
          git config user.name "MachineMind Bot"
          git config user.email "bot@machinemind.ai"
          git add .
          git commit -m "feat(${{ inputs.component_name }}): add component [bot]" || exit 0
          git push

      - name: Notify Complete
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ inputs.chat_id }}",
              "text": "âœ… <b>Component Created!</b>\n\nğŸ§© <code>${{ inputs.component_name }}</code>\nğŸ“ <code>components/${{ inputs.component_name }}.tsx</code>\n\n<b>Includes:</b>\nâ€¢ TypeScript interface\nâ€¢ Loading state\nâ€¢ Client component\n\nğŸ”— <a href=\"https://github.com/Showowt/${{ inputs.project }}/blob/main/components/${{ inputs.component_name }}.tsx\">View on GitHub</a>",
              "parse_mode": "HTML"
            }'
